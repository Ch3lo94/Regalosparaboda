<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Regalos de Boda</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body {
  margin:0;
  background:#f3f3f3;
  font-family:"Segoe UI", sans-serif;
}

/* Encabezado */
.center { 
  text-align:center; 
  width:100%;
  padding:20px;
  box-sizing:border-box;
  max-width:650px;
  margin:0 auto;
}

h1 { font-size:28px; margin-bottom:15px; }
h2 { font-size:24px; margin-bottom:10px; }
p  { font-size:16px; line-height:1.5; }

/* Imagen bienvenida */
.welcome-img {
  width:90%;
  max-width:450px;
  border-radius:20px;
  box-shadow:0 4px 12px rgba(0,0,0,0.25);
}

/* GRID ‚Äî TARJETAS M√ÅS GRANDES */
.grid-wrapper {
  width:100%;
  padding:20px;
  box-sizing:border-box;
  display:flex;
  justify-content:center;
}

.grid {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(220px, 1fr));
  gap:24px;
  width:100%;
  max-width:1100px;
}

/* TARJETA */
.card {
  background:white;
  border-radius:16px;
  overflow:hidden;
  cursor:pointer;
  border:3px solid transparent;
  transition:.25s ease;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  position:relative;
}

.card:hover {
  transform:translateY(-5px);
  box-shadow:0 6px 18px rgba(0,0,0,0.18);
}

/* Imagen m√°s grande */
.card img {
  width:100%;
  height:200px;
  object-fit:cover;
}

/* Contenido */
.card-content {
  padding:16px;
}

.card-content h3 {
  font-size:17px;
  margin:0 0 8px 0;
}

.card-content p {
  font-size:14px;
  margin:0;
  color:#555;
}

/* TARJETA SELECCIONADA */
.selected {
  border:4px solid #d4af37 !important;
  box-shadow:0 6px 20px rgba(212,175,55,0.6) !important;
  transform:scale(1.03);
}

/* CARTEL YA ELEGIDO */
.badge-agotado {
  width:100%;
  background:#d4af37;
  color:black;
  font-weight:bold;
  text-align:center;
  padding:6px 0;
  font-size:15px;
  position:absolute;
  bottom:0;
  left:0;
}

/* TARJETA DESHABILITADA */
.agotado {
  opacity:0.45;
  pointer-events:none;
}

/* BOT√ìN CONFIRMAR */
#confirm-btn {
  display:block;
  margin:25px auto;
  padding:14px 34px;
  background:#0077ff;
  color:white;
  border:none;
  border-radius:14px;
  font-size:20px;
  cursor:pointer;
}
#confirm-btn:disabled {
  background:#aaa;
  cursor:not-allowed;
}

/* Google Sign-in */
#google-btn-wrapper {
  display:flex;
  justify-content:center;
  margin-top:20px;
}

/* Responsivo */
@media (max-width:480px) {
  .grid {
    grid-template-columns:repeat(2, 1fr);
    gap:16px;
  }
  .card img { height:150px; }
}
</style>
</head>

<body>

<!-- Pantalla bienvenida -->
<div id="welcome" class="center">
  <img class="welcome-img"
       src="https://raw.githubusercontent.com/Ch3lo94/Regalos_Boda/main/images/IMG-20251127-WA0008.jpg">

  <h2>Nos ayudar√≠as mucho con estas cosas que nos faltan ‚ù§Ô∏è</h2>
  <p>Ingres√° con tu cuenta de Google y seleccion√° lo que desees regalarnos.</p>

  <div id="google-btn-wrapper">
    <div id="g_id_onload"
      data-client_id="342769047778-jc52eh3n59a3vjocagmomi8pln5kbqv3.apps.googleusercontent.com"
      data-callback="handleCredentialResponse">
    </div>

    <div class="g_id_signin"
      data-type="standard"
      data-size="large"
      data-theme="filled_blue">
    </div>
  </div>
</div>

<!-- Cat√°logo -->
<div id="catalogo" class="hidden">
  <h1 class="center">Eleg√≠ uno o m√°s regalo</h1>
  <div class="grid-wrapper">
    <div id="grid" class="grid"></div>
  </div>

  <button id="confirm-btn" disabled>Confirmar selecci√≥n</button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyISWbCW9HkNFs_4tqYFjNrQW6GLU9F-MwytJq1f_ilyB0Y5lF3H7znpV_0CRCWiLSS/exec";

let usuario = null;
let seleccion = [];

/* Mensaje final */
function mostrarMensajeFinal() {
  document.body.innerHTML = `
    <div class="center">
      <h1>¬°Gracias por tu regalo! üéÅ</h1>
      <p>Tu respuesta ya qued√≥ registrada ‚ù§Ô∏è</p>
    </div>`;
}

/* Login Google */
async function handleCredentialResponse(response) {
  const payload = JSON.parse(atob(response.credential.split('.')[1]));
  usuario = {
    nombre: payload.given_name,
    apellido: payload.family_name,
    email: payload.email.trim().toLowerCase()
  };

  if (localStorage.getItem("respondio_" + usuario.email)) {
    mostrarMensajeFinal();
    return;
  }

  const valid = await fetch(API + "?email=" + usuario.email);
  const result = await valid.json();

  if (result.yaRespondio === true) {
    localStorage.setItem("respondio_" + usuario.email, "1");
    mostrarMensajeFinal();
    return;
  }

  document.getElementById("welcome").classList.add("hidden");
  document.getElementById("catalogo").classList.remove("hidden");
  cargarCatalogo();
}

/* Cargar cat√°logo */
async function cargarCatalogo() {
  const res = await fetch(API);
  const items = await res.json();
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  items.forEach(item => {
    const card = document.createElement("div");
    card.className = "card";
    
    let badge = "";

    if (item.stockRestante <= 0) {
      card.classList.add("agotado");
      badge = `<div class="badge-agotado">YA ELEGIDO</div>`;
    }

    card.innerHTML = `
      <img src="${item.imagen}">
      <div class="card-content">
        <h3>${item.nombre}</h3>
        <p>${item.descripcion || ''}</p>
      </div>
      ${badge}
    `;

    if (item.stockRestante > 0) {
      card.onclick = () => toggle(item.id, card);
    }

    grid.appendChild(card);
  });
}

/* Selecci√≥n */
function toggle(id, card) {
  if (seleccion.includes(id)) {
    seleccion = seleccion.filter(x => x !== id);
    card.classList.remove("selected");
  } else {
    seleccion.push(id);
    card.classList.add("selected");
  }
  document.getElementById("confirm-btn").disabled = seleccion.length === 0;
}

/* Confirmar */
document.getElementById("confirm-btn").onclick = async () => {
  const resp = await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      nombre: usuario.nombre,
      apellido: usuario.apellido,
      email: usuario.email,
      seleccion
    })
  });

  const r = await resp.json();

  if (r.success) {
    localStorage.setItem("respondio_" + usuario.email, "1");
    mostrarMensajeFinal();
  } else {
    alert("Error: " + r.error);
  }
};
</script>

</body>
</html>

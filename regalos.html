<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial;
      text-align: center;
      padding: 20px;
      background: #fafafa;
    }

    h2 {
      margin-bottom: 5px;
    }

    .gift-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .gift {
      width: 220px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: 0.25s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }

    .gift.selected {
      border-color: #4285F4;
      box-shadow: 0 0 10px rgba(66,133,244,0.5);
      background: #e8f0fe;
    }

    .gift img {
      width: 100%;
      border-radius: 10px;
    }

    .send-button {
      background: #34A853;
      color: white;
      padding: 15px;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      cursor: pointer;
      width: 100%;
      max-width: 350px;
      margin-top: 25px;
    }

    #loading {
      display: none;
      font-size: 18px;
      margin-top: 20px;
      color: #555;
    }
  </style>
</head>
<body>

  <h2>Elegí el regalo que deseas darnos ❤️</h2>
  <p>Tocá uno para seleccionarlo.</p>

  <div class="gift-container" id="giftList"></div>

  <button class="send-button" onclick="enviarSeleccion()">Enviar Selección</button>

  <div id="loading">Enviando tu selección... ⏳</div>

  <script>
    let regaloElegido = null;

    // Obtener email desde la URL
    const params = new URLSearchParams(window.location.search);
    const email = params.get("email");

    // Cargar regalos desde Apps Script
    google.script.run.withSuccessHandler(mostrarRegalos).getRegalos();

    function mostrarRegalos(lista) {
      const cont = document.getElementById("giftList");
      cont.innerHTML = "";

      lista.forEach(r => {
        const div = document.createElement("div");
        div.className = "gift";
        div.innerHTML = `
          <img src="${r.imagen}">
          <h3>${r.nombre}</h3>
          <p>${r.descripcion}</p>
        `;
        div.onclick = () => seleccionar(div, r.id);
        cont.appendChild(div);
      });
    }

    function seleccionar(element, id) {
      document.querySelectorAll(".gift").forEach(g => g.classList.remove("selected"));
      element.classList.add("selected");
      regaloElegido = id;
    }

    function enviarSeleccion() {
      if (!regaloElegido) {
        alert("Elegí un regalo antes de continuar.");
        return;
      }

      document.getElementById("loading").style.display = "block";

      google.script.run
        .withSuccessHandler(res => {
          if (res.success) {
            window.location.href = "exit.html";
          } else {
            alert("Error: " + res.error);
            window.location.reload();
          }
        })
        .guardarRespuesta(email, [regaloElegido]); // ← array de IDs
    }
  </script>

</body>
</html>
